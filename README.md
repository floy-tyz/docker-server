# docker-engine
<p>В большенстве случаев на одном сервере требуется запускать более одного проекта, в таком случае при использовании
docker появляется проблема - необходимо для каждого проекта иметь свой nginx, а порт 80 и 443 нельзя переиспользовать
боеее одного раза, тогда нам на помощь приходит обратное проксирование, которое так же можно осуществить в вебсервере
nginx.

Отличным образом может полсужить jwilder/nginx-proxy, который на основе сокета от докера определяет запущенные контейнеры
и обнаружевует переменную среды VIRTUAL_HOST, при ее обнаружении он создает конфиг для nginx, который как раз таки выполняют
функцию обратного проксирования для сервиса.

docker-compose:

###

version: '3.0'

services:

    proxy:
        image: jwilder/nginx-proxy
        ports:
            - "81:80"
        volumes:
            - /var/run/docker.sock:/tmp/docker.sock:ro
        networks:
            - proxy


networks:

    proxy:
        driver: bridge

###

Также записываем сервис proxy(nginx-proxy) в новую сеть докера и выбираем драйвер bridge - мост, это позволит нам добавлять
другие сервисы в нашу обратно проксируемую сеть, например мы будем использовать ее для еще одной сети под название frontend

networks:

    proxy:
        driver: bridge
    frontend:
        external:
            name: docker-engine_proxy

docker-engine_proxy - имя сервиса обратного прокси после создания сети, имя было сгенерировано из папка-серива__имя-сервиса
external - обозначает, что жизненный цикл данной сети будет определяться сервисом прокси

Так же создадим еще одну сеть - backend, для использования этой сети между теми сервисами доступ к которым из вне не должно
быть, например php-fpm, mysql и тому подобное.
                                                                             
</p>
